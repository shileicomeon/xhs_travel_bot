# 飞书多维表格设置指南

## 表格字段设计

为了完整记录每次发布的情况，飞书多维表格需要包含以下字段：

### 必需字段

| 字段名       | 字段类型     | 说明                 | 示例                                   |
| ------------ | ------------ | -------------------- | -------------------------------------- |
| **日期**     | 日期         | 发布日期             | 2025-12-17                             |
| **发布时间** | 文本         | 具体发布时间         | 22:18:26                               |
| **标题**     | 文本         | 发布的标题           | 成都三日游攻略｜本地人带你玩转精华景点 |
| **城市**     | 文本         | 目标城市或"文字卡片" | 成都                                   |
| **模式**     | 单选         | 发布模式             | 旅游攻略 / 文字卡片                    |
| **状态**     | 单选         | 发布状态             | ✅ 成功 / ❌ 失败                      |
| **笔记 ID**  | 文本         | 小红书笔记 ID        | 6xxxxxxxxxxxx                          |
| **耗时**     | 文本         | 执行耗时             | 132.7 秒                               |
| **图片数**   | 数字         | 图片数量             | 6                                      |
| **失败原因** | 文本（多行） | 失败时的错误信息     | 搜索小红书内容失败: ...                |

### 字段详细说明

#### 1. 日期（Date）

- **类型**：日期
- **格式**：YYYY-MM-DD
- **用途**：用于统计每日发布情况

#### 2. 发布时间（Text）

- **类型**：文本
- **格式**：HH:MM:SS
- **用途**：记录具体发布时刻

#### 3. 标题（Text）

- **类型**：文本
- **长度**：建议 100 字符以内
- **用途**：快速识别发布内容

#### 4. 城市（Text）

- **类型**：文本
- **值域**：
  - 具体城市名（如：北京、上海、成都）
  - "文字卡片"（表示文字卡片模式）

#### 5. 模式（Single Select）

- **类型**：单选
- **选项**：
  - 🗺️ 旅游攻略（80%概率）
  - 💬 文字卡片（20%概率）
- **用途**：区分发布类型

#### 6. 状态（Single Select）

- **类型**：单选
- **选项**：
  - ✅ 成功（绿色）
  - ❌ 失败（红色）
- **用途**：一眼看出成功率

#### 7. 笔记 ID（Text）

- **类型**：文本
- **格式**：小红书笔记 ID 或特殊状态
- **特殊值**：
  - `draft_or_pending` - 内容可能在草稿箱
  - `N/A` - 未获取到 ID
- **用途**：追溯已发布内容

#### 8. 耗时（Text）

- **类型**：文本
- **格式**：XX.X 秒
- **用途**：监控系统性能

#### 9. 图片数（Number）

- **类型**：数字
- **值域**：1-9（通常是 6 或 1）
- **用途**：记录内容规模

#### 10. 失败原因（Multi-line Text）

- **类型**：文本（多行）
- **最大长度**：200 字符（自动截断）
- **用途**：失败时记录错误信息，成功时为空

## 快速设置步骤

### 1. 创建表格

1. 打开飞书多维表格
2. 访问：https://ai.feishu.cn/base/GWogbUnuIaKIkusPusgcglkhnXb
3. 找到对应的表格（table_id: tbleCc4ZYwmogVmt）

### 2. 添加字段

按照上述字段列表，依次添加字段：

- 点击表格右侧的 "+" 号
- 选择字段类型
- 设置字段名称
- 对于单选字段，添加对应的选项

### 3. 设置权限

确保飞书应用具有以下权限：

- ✅ `bitable:app` - 多维表格应用权限
- ✅ `base:record:create` - 创建记录权限
- ✅ `base:record:read` - 读取记录权限
- ✅ `bitable:app:readonly` - 只读权限

访问权限管理页面：
https://open.feishu.cn/app/cli_a9c8e06e16791ced/auth

### 4. 测试记录

运行以下命令测试记录功能：

```bash
cd /Users/shialei/PycharmProjects/xhs_travel_bot
source venv/bin/activate
python -c "
from dotenv import load_dotenv
load_dotenv('config/.env')
from src.services.feishu_client import FeishuClient
from datetime import datetime

feishu = FeishuClient()
record = {
    '日期': datetime.now().strftime('%Y-%m-%d'),
    '发布时间': datetime.now().strftime('%H:%M:%S'),
    '标题': '测试标题',
    '城市': '测试城市',
    '模式': '旅游攻略',
    '状态': '✅ 成功',
    '笔记ID': 'test_123456',
    '耗时': '100.0秒',
    '图片数': '6',
    '失败原因': ''
}
feishu.append_table_record(record)
print('✅ 测试记录成功')
"
```

## 数据示例

### 成功记录示例

| 日期       | 发布时间 | 标题             | 城市     | 模式     | 状态    | 笔记 ID          | 耗时     | 图片数 | 失败原因 |
| ---------- | -------- | ---------------- | -------- | -------- | ------- | ---------------- | -------- | ------ | -------- |
| 2025-12-17 | 22:18:26 | 上海两天一夜攻略 | 上海     | 旅游攻略 | ✅ 成功 | draft_or_pending | 132.7 秒 | 6      |          |
| 2025-12-17 | 10:35:12 | 🌊 好想去看海    | 文字卡片 | 文字卡片 | ✅ 成功 | draft_or_pending | 45.2 秒  | 1      |          |

### 失败记录示例

| 日期       | 发布时间 | 标题         | 城市 | 模式     | 状态    | 笔记 ID | 耗时 | 图片数 | 失败原因                                      |
| ---------- | -------- | ------------ | ---- | -------- | ------- | ------- | ---- | ------ | --------------------------------------------- |
| 2025-12-17 | 09:15:33 | 北京旅游攻略 | 北京 | 旅游攻略 | ❌ 失败 | N/A     | N/A  | 6      | 搜索小红书内容失败: 所有帖子都缺少 xsec_token |
| 2025-12-17 | 11:22:45 | 成都攻略     | 成都 | 旅游攻略 | ❌ 失败 | N/A     | N/A  | 6      | 内容生成失败: AI 服务超时                     |

## 数据统计示例

有了这些字段，你可以轻松统计：

### 1. 成功率

```
成功数 / 总数 = 成功率
```

### 2. 每日发布数

按"日期"字段分组统计

### 3. 模式分布

- 旅游攻略：XX%
- 文字卡片：XX%

### 4. 平均耗时

对"耗时"字段求平均值

### 5. 常见失败原因

对"失败原因"字段进行词频分析

### 6. 城市覆盖

统计不同城市的发布次数

## 视图建议

### 视图 1：全部记录

- 显示所有字段
- 按"日期"和"发布时间"降序排列

### 视图 2：成功记录

- 筛选条件：状态 = "✅ 成功"
- 隐藏"失败原因"字段

### 视图 3：失败记录

- 筛选条件：状态 = "❌ 失败"
- 重点显示"失败原因"字段

### 视图 4：今日统计

- 筛选条件：日期 = 今天
- 按"发布时间"排序

## 注意事项

1. **字段名称必须完全匹配**：代码中使用的字段名（如"日期"、"标题"）必须与表格中的字段名完全一致（包括中英文、大小写）

2. **数据类型要对应**：

   - "图片数"应设为数字类型，代码会传入字符串，飞书会自动转换
   - "日期"应设为日期类型
   - 单选字段的选项值要预先创建好

3. **字段顺序不重要**：飞书 API 使用字段名匹配，顺序可以随意调整

4. **历史数据**：首次设置后，历史记录可以手动补充或让系统自动积累

5. **备份**：建议定期导出表格数据备份
